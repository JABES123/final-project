<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis del Modelo de Clasificaci√≥n de Radiograf√≠as de T√≥rax</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-step {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .flow-arrow {
            font-size: 2rem;
            font-weight: bold;
            color: #4d8fac;
        }
        .matrix-table {
            width: 100%;
            max-width: 350px;
            border-collapse: collapse;
            margin: auto;
        }
        .matrix-table th, .matrix-table td {
            border: 1px solid #9ad2cb;
            padding: 1rem;
            text-align: center;
        }
        .matrix-table th {
            background-color: #003f5c;
            color: white;
        }
        .matrix-table .label-col {
             background-color: #f0f9ff;
        }
         .matrix-table .correct {
            background-color: #dcfce7;
         }
         .matrix-table .incorrect {
            background-color: #fee2e2;
         }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-[#003f5c] text-white p-8 text-center shadow-lg">
        <h1 class="text-4xl font-bold mb-2">An√°lisis del Modelo de Clasificaci√≥n de Radiograf√≠as</h1>
        <p class="text-xl text-[#9ad2cb]">Un Vistazo Visual al Proceso de Deep Learning</p>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        
        <section id="model-selection" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">1. Mejor modelo del BenchMarking : DenseNet-121</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üß† Transferencia de Aprendizaje</h3>
                    <p>Se utiliz√≥ un modelo DenseNet-121 pre-entrenado en ImageNet. Esto permite que el modelo aproveche un vasto conocimiento previo sobre caracter√≠sticas visuales generales, acelerando y mejorando el entrenamiento para nuestra tarea espec√≠fica de radiograf√≠as.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üîó Arquitectura Densa</h3>
                    <p>Cada capa recibe informaci√≥n de todas las capas anteriores. Este dise√±o mejora el flujo de gradientes, combate el problema del "desvanecimiento del gradiente" y promueve la reutilizaci√≥n de caracter√≠sticas, haciendo el modelo m√°s eficiente y potente.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">‚öôÔ∏è Eficiencia de Par√°metros</h3>
                    <p>Gracias a la reutilizaci√≥n de caracter√≠sticas, DenseNet logra un alto rendimiento con menos par√°metros en comparaci√≥n con otras arquitecturas profundas. Esto reduce el riesgo de sobreajuste y los requisitos computacionales.</p>
                </div>
            </div>
        </section>

        <section id="model-comparison" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">Comparaci√≥n de Modelos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">DenseNet-121</h3>
                    <p>Se caracteriza por sus conexiones densas, lo que facilita la reutilizaci√≥n de caracter√≠sticas y mitiga la desaparici√≥n del gradiente.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">ResNet-50</h3>
                    <p>Conocida por sus "conexiones residuales" que permiten el entrenamiento de redes muy profundas al resolver el problema del gradiente decreciente.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">ViT (Vision Transformer)</h3>
                    <p>Adapta la arquitectura de los transformadores al dominio de la visi√≥n, tratando las im√°genes como una secuencia de "parches" y utilizando mecanismos de auto-atenci√≥n para capturar dependencias globales.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">EfficientNet</h3>
                    <p>Se enfoca en optimizar la red de manera m√°s eficiente a trav√©s de una t√©cnica de escalado compuesto.</p>
                </div>
            </div>
        </section>

        <section id="data-engineering" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">2. Ingenier√≠a de Datos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üñºÔ∏è Aumento de Datos (Data Augmentation)</h3>
                    <p class="mb-4">Para mejorar la robustez del modelo, se aplicaron transformaciones aleatorias a las im√°genes de entrenamiento, creando nuevas muestras y exponiendo al modelo a una mayor variabilidad.</p>
                     <div class="flex justify-around items-center text-center text-gray-600">
                        <div><span class="text-3xl">üîÑ</span><p>Rotaci√≥n</p></div>
                        <div><span class="text-3xl">‚úÇÔ∏è</span><p>Recorte</p></div>
                        <div><span class="text-3xl">‚ÜîÔ∏è</span><p>Volteo</p></div>
                        <div><span class="text-3xl">üí°</span><p>Brillo</p></div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">‚öñÔ∏è Balanceo de Clases</h3>
                    <p class="mb-4">El dataset de patolog√≠as es inherentemente desequilibrado. Se us√≥ un `WeightedRandomSampler` para dar m√°s peso a las clases minoritarias durante el entrenamiento, evitando que el modelo las ignore.</p>
                    <div class="chart-container h-[250px] md:h-[300px]">
                        <canvas id="classBalanceChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="optimization" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">3. Optimizaci√≥n del Modelo</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üéØ Funci√≥n de P√©rdida: FocalLoss</h3>
                    <p>Se emple√≥ `FocalLoss` para que el modelo se concentrara en los ejemplos dif√≠ciles de clasificar, reduciendo la influencia de los ejemplos f√°ciles de la clase mayoritaria y mejorando el aprendizaje en datos desequilibrados.</p>
                    <div class="mt-4">
                        <h4 class="text-lg font-semibold text-[#4d8fac]">¬øC√≥mo se implementa Focal Loss?</h4>
                        <p>El Focal Loss es una extensi√≥n de la BCE (Binary Cross-Entropy) pensada para problemas con clases desbalanceadas. La f√≥rmula es:</p>
                        <p class="text-center my-2 bg-gray-100 p-2 rounded"><code>FL(p<sub>t</sub>) = -Œ±(1 - p<sub>t</sub>)<sup>Œ≥</sup> log(p<sub>t</sub>)</code></p>
                        <ul class="list-disc list-inside space-y-1">
                            <li><b>p<sub>t</sub></b>: Es la probabilidad que el modelo asigna a la clase correcta.</li>
                            <li><b>Œ± (alpha)</b>: Controla el balance entre clases.</li>
                            <li><b>Œ≥ (gamma)</b>: Controla el enfoque en ejemplos dif√≠ciles.</li>
                        </ul>
                    </div>
                    <div class="chart-container h-[250px] md:h-[300px]">
                        <canvas id="focalLossChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üõ†Ô∏è Estrategias de Fine-Tuning</h3>
                    <ul class="list-disc list-inside space-y-4">
                        <li>
                            <b>Divisi√≥n del dataset en 3 partes:</b>
                            <ul class="list-disc list-inside ml-4">
                                <li><b>Train set (train_loader):</b> para actualizar los pesos del modelo.</li>
                                <li><b>Validation set (val_loader):</b> para monitorear el desempe√±o en datos no vistos.</li>
                                <li><b>Test set:</b> se deja aparte y se usa al final para evaluar el modelo final.</li>
                            </ul>
                        </li>
                        <li>
                            <b>Early Stopping con paciencia (patience):</b>
                            <p>Si el AUC-ROC no mejora en `patience` √©pocas, se detiene el entrenamiento para evitar overfitting.</p>
                        </li>
                        <li>
                            <b>Checkpointing del mejor modelo:</b>
                            <p>Se guardan los pesos del modelo con el mejor AUC-ROC y se restauran al final.</p>
                        </li>
                        <li>
                            <b>Scheduler basado en validaci√≥n:</b>
                            <p><code>scheduler.step(val_loss)</code> ajusta la tasa de aprendizaje seg√∫n el desempe√±o en validaci√≥n (Learning Rate Scheduling).</p>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="evaluation" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">4. Evaluaci√≥n del Rendimiento</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6 lg:col-span-2">
                     <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">üìà Curva ROC y AUC-ROC</h3>
                     <p>La curva ROC visualiza el rendimiento del clasificador. El √°rea bajo la curva (AUC) nos da una m√©trica √∫nica de su capacidad para distinguir entre clases. Un valor m√°s alto es mejor.</p>
                    <div class="chart-container h-[300px] md:h-[350px]">
                        <canvas id="rocCurveChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col justify-center items-center">
                    <h3 class="text-xl font-semibold mb-3 text-center text-[#4d8fac]">AUC-ROC Score</h3>
                    <p class="text-7xl font-bold text-[#ff6f61]">0.902</p>
                    <p class="text-center mt-4">Un valor de 0.902 indica una excelente capacidad del modelo para discriminar entre pacientes con y sin patolog√≠as.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 md:col-span-2 lg:col-span-3">
                     <h3 class="text-xl font-semibold mb-3 text-center text-[#4d8fac]">üìä Matriz de Confusi√≥n</h3>
                     <p class="text-center mb-4">Esta tabla resume el rendimiento, mostrando las predicciones correctas e incorrectas. Es crucial para entender d√≥nde falla el modelo, especialmente los Falsos Negativos (FN), que son los errores m√°s cr√≠ticos en un diagn√≥stico m√©dico.</p>
                     <div class="overflow-x-auto">
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th colspan="2" rowspan="2"></th>
                                    <th colspan="2">Valor Predicho</th>
                                </tr>
                                <tr>
                                    <th>Positivo</th>
                                    <th>Negativo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th rowspan="2" class="label-col">Valor<br>Real</th>
                                    <th>Positivo</th>
                                    <td class="correct font-bold">TP: 850</td>
                                    <td class="incorrect font-bold">FN: 150</td>
                                </tr>
                                <tr>
                                    <th>Negativo</th>
                                    <td class="incorrect font-bold">FP: 100</td>
                                    <td class="correct font-bold">TN: 900</td>
                                </tr>
                            </tbody>
                        </table>
                     </div>
                </div>
            </div>
        </section>

        <section id="results-discussion" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">Resultados Experimentales y Discusi√≥n</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">Resultados Experimentales</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="border-b-2 p-2">Modelo</th>
                                <th class="border-b-2 p-2">AUC-ROC</th>
                                <th class="border-b-2 p-2">MAE</th>
                                <th class="border-b-2 p-2">R2</th>
                                <th class="border-b-2 p-2">Accuracy</th>
                                <th class="border-b-2 p-2">F1-score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border-b p-2"><strong>DenseNet-121</strong></td>
                                <td class="border-b p-2">0.841</td>
                                <td class="border-b p-2">0.105</td>
                                <td class="border-b p-2">0.301</td>
                                <td class="border-b p-2">0.902</td>
                                <td class="border-b p-2">0.795</td>
                            </tr>
                            <tr>
                                <td class="border-b p-2"><strong>ViT</strong></td>
                                <td class="border-b p-2">0.808</td>
                                <td class="border-b p-2">0.119</td>
                                <td class="border-b p-2">0.224</td>
                                <td class="border-b p-2">0.890</td>
                                <td class="border-b p-2">0.760</td>
                            </tr>
                            <tr>
                                <td class="border-b p-2"><strong>ResNet-50</strong></td>
                                <td class="border-b p-2">0.815</td>
                                <td class="border-b p-2">0.115</td>
                                <td class="border-b p-2">0.267</td>
                                <td class="border-b p-2">0.893</td>
                                <td class="border-b p-2">0.771</td>
                            </tr>
                            <tr>
                                <td class="border-b p-2"><strong>EfficientNet</strong></td>
                                <td class="border-b p-2">0.830</td>
                                <td class="border-b p-2">0.103</td>
                                <td class="border-b p-2">0.315</td>
                                <td class="border-b p-2">0.899</td>
                                <td class="border-b p-2">0.785</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="mt-4">Los resultados muestran que <strong>DenseNet-121</strong> mantiene su ventaja en las m√©tricas clave, logrando un mejor <strong>AUC-ROC</strong> y <strong>F1-score</strong>. Sin embargo, <strong>EfficientNet</strong> demostr√≥ una ligera superioridad en las m√©tricas de error (MAE y R2).</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 mt-8">
                <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">Discusi√≥n y Conclusiones</h3>
                <p>Los resultados sugieren que las arquitecturas basadas en CNN, en particular <strong>DenseNet-121</strong>, siguen siendo extremadamente competitivas para tareas de clasificaci√≥n de im√°genes m√©dicas. Su dise√±o, que promueve la reutilizaci√≥n de caracter√≠sticas, parece ser particularmente beneficioso para la detecci√≥n de m√∫ltiples patolog√≠as. Aunque el rendimiento de ViT fue inferior, su promesa como arquitectura de vanguardia sigue siendo relevante, y podr√≠a requerir m√°s datos o una configuraci√≥n de hiperpar√°metros diferente para alcanzar su m√°ximo potencial. En conclusi√≥n, este estudio establece a <strong>DenseNet-121</strong> como un modelo de referencia para la clasificaci√≥n multietiqueta en radiograf√≠as de t√≥rax.</p>
            </div>
        </section>
        
        <section id="conclusions" class="mb-12">
        <section id="conclusions" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">Conclusiones Generales del Entrenamiento</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-3 text-[#4d8fac]">‚úÖ Comportamiento del Entrenamiento</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li><b>Tendencia global consistente:</b> Lo importante no es cada batch, sino que en general el training loss baje a lo largo de las √©pocas.</li>
                        <li><b>Generalizaci√≥n:</b> La red generaliza bien cuando a lo largo de las √©pocas el validation loss y el training loss bajan.</li>
                        <li><b>No aprendizaje:</b> La red no est√° aprendiendo cuando el validation loss y el training loss no bajan.</li>
                        <li><b>Memorizaci√≥n:</b> La red est√° memorizando los valores cuando el validation loss es alto y el training loss desciende s√∫bitamente.</li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-[#003f5c] text-white p-4 text-center mt-8">
        <p>&copy; 2025 An√°lisis de Modelo de Deep Learning. Todos los derechos reservados.</p>
    </footer>

    <script>
        const tooltipTitleCallback = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            }
        };

        const wrapLabel = (label) => {
            const maxLen = 16;
            if (label.length <= maxLen) return label;
            const words = label.split(' ');
            let lines = [];
            let currentLine = '';
            for (const word of words) {
                if ((currentLine + ' ' + word).trim().length > maxLen) {
                    lines.push(currentLine.trim());
                    currentLine = word;
                } else {
                    currentLine = (currentLine + ' ' + word).trim();
                }
            }
            if (currentLine) lines.push(currentLine.trim());
            return lines;
        };

        const classBalanceCtx = document.getElementById('classBalanceChart').getContext('2d');
        const classBalanceLabels = ['Neumot√≥rax', 'Cardiomegalia', 'Infiltraci√≥n', 'N√≥dulo', 'Masa', 'Derrame', 'Atelectasia', 'Sin hallazgos'].map(wrapLabel);
        new Chart(classBalanceCtx, {
            type: 'bar',
            data: {
                labels: classBalanceLabels,
                datasets: [{
                    label: 'Frecuencia de Patolog√≠as',
                    data: [220, 850, 1200, 350, 290, 980, 750, 25000],
                    backgroundColor: ['#9ad2cb', '#9ad2cb', '#9ad2cb', '#9ad2cb', '#9ad2cb', '#9ad2cb', '#9ad2cb', '#ff6f61'],
                    borderColor: '#4d8fac',
                    borderWidth: 1
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        type: 'logarithmic',
                        ticks: {
                            color: '#003f5c'
                        }
                    },
                    x: {
                         ticks: {
                            color: '#003f5c'
                        }
                    }
                },
                plugins: {
                    ...tooltipTitleCallback.plugins,
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Distribuci√≥n de Clases (Escala Logar√≠tmica)',
                        color: '#003f5c',
                        font: { size: 14 }
                    }
                }
            }
        });

        const focalLossCtx = document.getElementById('focalLossChart').getContext('2d');
        new Chart(focalLossCtx, {
            type: 'line',
            data: {
                labels: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9],
                datasets: [{
                    label: 'BCE Loss (Ej. f√°cil)',
                    data: [2.3, 1.6, 1.2, 0.9, 0.7, 0.5, 0.35, 0.22, 0.1],
                    borderColor: '#ffbc61',
                    backgroundColor: 'transparent',
                    borderWidth: 2
                }, {
                    label: 'Focal Loss (Ej. f√°cil)',
                    data: [0.5, 0.25, 0.1, 0.05, 0.02, 0.01, 0.005, 0.001, 0.0001],
                    borderColor: '#4d8fac',
                    backgroundColor: 'transparent',
                    borderWidth: 3,
                    borderDash: [5, 5]
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                         ticks: { color: '#003f5c' }
                    },
                    x: {
                        title: { display: true, text: 'Confianza de Predicci√≥n', color: '#003f5c'},
                        ticks: { color: '#003f5c' }
                    }
                },
                plugins: {
                    ...tooltipTitleCallback.plugins,
                    title: {
                        display: true,
                        text: 'Comparaci√≥n de P√©rdida en Ejemplos F√°ciles',
                        color: '#003f5c',
                        font: { size: 14 }
                    }
                }
            }
        });

        const rocCurveCtx = document.getElementById('rocCurveChart').getContext('2d');
        new Chart(rocCurveCtx, {
            type: 'line',
            data: {
                labels: [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                datasets: [{
                    label: 'Curva ROC del Modelo',
                    data: [0, 0.65, 0.8, 0.88, 0.91, 0.93, 0.95, 0.97, 0.98, 0.99, 1.0],
                    borderColor: '#ff6f61',
                    backgroundColor: 'rgba(255, 111, 97, 0.2)',
                    fill: true,
                    tension: 0.3
                },{
                    label: 'Clasificador Aleatorio',
                    data: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                    borderColor: '#9ad2cb',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1,
                        title: { display: true, text: 'Tasa de Verdaderos Positivos', color: '#003f5c' },
                        ticks: { color: '#003f5c' }
                    },
                    x: {
                        beginAtZero: true,
                        max: 1,
                        title: { display: true, text: 'Tasa de Falsos Positivos', color: '#003f5c' },
                        ticks: { color: '#003f5c' }
                    }
                },
                ...tooltipTitleCallback
            }
        });
    </script>
</body>
</html>
